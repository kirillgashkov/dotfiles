#!/bin/sh
#
# Usage: template <template-file> [<destination-directory>]
#
# Copies the specified template file to the current working directory or to
# the optionally specified destination directory.
#
# The copied file will have the name of its template file's parent directory,
# so put your templates inside directories like '.gitignore' and 'LICENSE.md'
# for them to have these names after they have been copied.

fatal() {
    echo "$(basename $0): $@" >&2
    exit 1
}


library="${XDG_CONFIG_HOME:-$HOME/.config}/template/library"
filename="$(basename "$(dirname "$library/$1")")"


if [ -z "$1" ]; then
    fatal "template file was not specified"
fi

if [ ! -e "$library/$1" ]; then
    fatal "template file '$1' does not exist in the library"
fi

if [ ! -f "$library/$1" ]; then
    fatal "template file '$1' is not a regular file"
fi

[ -n "$2" ] && did_cd=0 && mkdir -p "$2" && cd "$2" && did_cd=1

if [ "$did_cd" = 0 ]; then
    fatal "destination directory '$2' cannot be reached"
fi

if [ -e "$PWD/$filename" ]; then
    fatal "destination directory already contains a file named '$filename'"
fi


cp "$library/$1" "$PWD/$filename"
