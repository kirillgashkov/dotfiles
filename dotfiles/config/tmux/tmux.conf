#
# Options
#


# UX

set-option -g mouse on               # Enable mouse support
set-option -g status-keys vi         # Use vi keys in status bar
set-option -g mode-keys vi           # Use vi keys in copy mode
set-option -g escape-time 0          # Remove the delay before the escape key is sent

set-option -g base-index 1           # Start counting windows from 1
set-option -g pane-base-index 1      # Start counting panes from 1
set-option -g renumber-windows on    # Renumber windows when a window is closed

set-option -g detach-on-destroy off  # Switch to another session when the current session is destroyed
set-option -g remain-on-exit on      # Don't destroy the pane when its command exits

set-option -g history-limit 10000    # Keep 10000 lines of history


# UI

set-option -g status-justify centre

set-option -g status-left "[#{session_name}] "
set-option -g status-left-length 33
set-option -g status-right ""

set-option -g status-style "bg=default"
set-option -g status-left-style "fg=yellow"
set-option -g status-right-style "fg=yellow"
set-option -g window-status-style "fg=gray50"
set-option -g window-status-current-style "fg=magenta"

set-option -g message-command-style "fg=yellow,bg=default"
set-option -g message-style "fg=black,bg=yellow"


#
# Key bindings
#


# Overrides

bind-key   -T prefix       "%"                    { split-window -h -c "#{pane_current_path}" ; select-layout -E }
bind-key   -T prefix       '"'                    { split-window -v -c "#{pane_current_path}" ; select-layout -E }
bind-key   -T prefix       x                      if-shell -F "#{e|==:#{window_panes},1}" { set-option -F @killed-window-index "#{window_index}" ; kill-pane ; run-shell -C 'select-window -t "=#{?#{e|<=:#{@killed-window-index},#{last_window_index}},#{@killed-window-index},#{last_window_index}}"' } { kill-pane ; select-layout -E }

bind-key   -T prefix       Up                     select-pane -U  # The default allowed key repeat, this doesn't
bind-key   -T prefix       Down                   select-pane -D  # The default allowed key repeat, this doesn't
bind-key   -T prefix       Left                   select-pane -L  # The default allowed key repeat, this doesn't
bind-key   -T prefix       Right                  select-pane -R  # The default allowed key repeat, this doesn't

bind-key   -T copy-mode-vi Escape                 if-shell -F "#{selection_present}" { send-keys -X clear-selection } { send-keys -X cancel }


# Definitions

bind-key   -T prefix       M-X                    confirm-before -p "kill-session #S? (y/n)" kill-session
bind-key   -T prefix       M-C                    command-prompt -I "" { new-session -s "%%" }
bind-key   -T prefix       "M-{"                  if-shell -F "#{!=:#{pane_mode},copy-mode}" { copy-mode } { send-keys -X cancel }
bind-key   -T prefix       M-P                    display-popup -w 35 -h 14 -E '/usr/local/bin/tmux list-sessions -F "#{session_name}" | /usr/local/bin/fzf --reverse --header "switch-session" | /usr/bin/xargs -I "{}" /usr/local/bin/tmux switch-client -t "={}"'
bind-key   -T prefix       M-K                    clear-history
bind-key   -T prefix       M-R                    respawn-pane -k
bind-key   -T prefix       "M-("                  select-window -t ":{end}"


#
# Mouse bindings
#


# Resets

unbind-key -T copy-mode    MouseDown1Pane
unbind-key -T copy-mode    MouseDrag1Pane
unbind-key -T copy-mode    MouseDragEnd1Pane
unbind-key -T copy-mode    WheelUpPane
unbind-key -T copy-mode    WheelDownPane
unbind-key -T copy-mode    DoubleClick1Pane
unbind-key -T copy-mode    TripleClick1Pane

unbind-key -T copy-mode-vi MouseDown1Pane
unbind-key -T copy-mode-vi MouseDrag1Pane
unbind-key -T copy-mode-vi MouseDragEnd1Pane
unbind-key -T copy-mode-vi WheelUpPane
unbind-key -T copy-mode-vi WheelDownPane
unbind-key -T copy-mode-vi DoubleClick1Pane
unbind-key -T copy-mode-vi TripleClick1Pane

unbind-key -T root         MouseDown1Pane
unbind-key -T root         MouseDown1Status
unbind-key -T root         MouseDown2Pane
unbind-key -T root         MouseDown3Pane
unbind-key -T root         MouseDown3Status
unbind-key -T root         MouseDown3StatusLeft
unbind-key -T root         MouseDrag1Pane
unbind-key -T root         MouseDrag1Border
unbind-key -T root         WheelUpPane
unbind-key -T root         WheelUpStatus
unbind-key -T root         WheelDownStatus
unbind-key -T root         DoubleClick1Pane
unbind-key -T root         TripleClick1Pane
unbind-key -T root         M-MouseDown3Pane


# Definitions

bind-key   -T copy-mode    WheelUpPane            { send-keys -X -N 5 scroll-up }    # The default selected pane, this doesn't
bind-key   -T copy-mode    WheelDownPane          { send-keys -X -N 5 scroll-down }  # The default selected pane, this doesn't

bind-key   -T copy-mode-vi WheelUpPane            { send-keys -X -N 5 scroll-up }    # The default selected pane, this doesn't
bind-key   -T copy-mode-vi WheelDownPane          { send-keys -X -N 5 scroll-down }  # The default selected pane, this doesn't

bind-key   -T root         MouseDown1Pane         { select-pane -t = ; send-keys -M }
bind-key   -T root         MouseDown2Pane         { select-pane -t = ; send-keys -M }
bind-key   -T root         MouseDown3Pane         { select-pane -t = ; send-keys -M }
bind-key   -T root         WheelUpPane            if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" { send-keys -M } { copy-mode -e }

bind-key   -T root         MouseDrag1Border       resize-pane -M

bind-key   -T root         MouseDown1Status       select-window -t =
bind-key   -T root         SecondClick1Status     command-prompt -I "#W" { rename-window -t = "%%" }

bind-key   -T root         SecondClick1StatusLeft command-prompt -I "#S" { rename-session "%%" }
